tasks:
  install:
    command: pnpm i

  clean:
    command: moon clean --lifetime '0 days' && rm -rf node_modules && rm -rf output
    options: { cache: false }

  lint:
    deps:
      - internalRootTsLintSpell
      - internalRootTsLintFormat
      - internalRootTsLintSyntax

  lint-fix:
    deps:
      - internalRootTsLintFormatFix
      - internalRootTsLintSyntaxFix

  bundle:
    deps:
      - main:build
      - preload:build
      - renderer:build
    script: |
      mkdir -p output/bundle
      cp -r apps/main/dist/bundle/* output/bundle
      cp -r apps/renderer/dist/bundle/* output/bundle
      cp -r libs/ts/preload/dist/bundle/* output/bundle

  start:
    command: cross-env ELECTRON_DISABLE_SECURITY_WARNINGS=true electron --enable-logging .

  start-dev:
    deps:
      - core:build
      - interop:build
    options:
      cache: false
    command: cross-env ELECTRON_DISABLE_SECURITY_WARNINGS=true electron-vite dev -w --entry output/debug/main/main.js

  # --------------------------------------------------------------------------
  # internal tasks
  # --------------------------------------------------------------------------

  internalRootTsLintFormat:
    command: npx prettier --check --config etc/config/.prettierrc.json --ignore-path etc/config/.prettierignore --cache . '!apps' '!libs'

  internalRootTsLintSpell:
    command: npx cspell --dot --no-must-find-files --no-progress -c etc/config/.cspell.json -e apps -e libs .

  internalRootTsLintSyntax:
    command: eslint -c "$workspaceRoot/eslint.config.mjs" --max-warnings 0 . --ignore-pattern 'apps/' --ignore-pattern 'libs/' --ignore-pattern 'output/'

  internalRootTsLintFormatFix:
    extends: internalRootTsLintFormat
    args: --write

  internalRootTsLintSyntaxFix:
    extends: internalRootTsLintSyntax
    args: --fix
